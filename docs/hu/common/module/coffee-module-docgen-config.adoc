ifndef::imagesdir[:imagesdir: ../../pic]

[#common_module_coffee-module-docgen-config]
= coffee-module-docgen-config

A modul c√©lja, hogy a konfigur√°ci√≥s kulcsokat tartalmaz√≥ oszt√°lyokb√≥l dokument√°ci√≥t gener√°ljon

== Haszn√°lata

Haszn√°lat√°hoz az alabbi f√ºgg≈ës√©get kell hozz√°adni a `pom.xml`-hez:
[source,xml]
----
<dependency>
    <groupId>hu.icellmobilsoft.coffee</groupId>
    <artifactId>coffee-module-docgen-config</artifactId>
</dependency>
----

=== Statikus konfigur√°ci√≥s kulcsok eset√©n
Ez ut√°n a konfigur√°ci√≥s kulcsokat tartalmaz√≥ oszt√°lyokat kell felannot√°lni a `@ConfigDoc` annot√°ci√≥val.

Ha ezzel megvagyunk alap√©rtelmezetten a ford√≠t√°skor az elk√©sz√ºlt `.jar` f√°jlba beker√ºl a gener√°lt asciidoc a `META-INF/config_keys.adoc` n√©ven.
A kulcsok az els≈ë pont karakter el≈ëtti prefix szerint k√ºl√∂n t√°bl√°zatokban jelennek meg.

==== P√©lda

[source,java]
----
@ConfigDoc // <1>
public interface ConfigDocExample {

    /**
     * test prefix
     */
    @ConfigDoc(exclude = true) // <2>
    String PREFIX = "test.";

    /**
     * test2
     */
    String test2 = "test2.xxx";

    /**
     * Lorem ipsum dolor sit amet, consectetur adipisicing elit. Illo, placeat!
     */
    String foo = PREFIX + "foo";

    /**
     * Lorem ipsum dolor sit amet, consectetur adipisicing elit. Iusto, sapiente?
     */
    @ConfigDoc(description = "Override...") // <3>
    String bar = PREFIX + "bar";

    /**
     * Lorem ipsum dolor sit amet, consectetur adipisicing elit. Ipsam, similique?
     * @since 3.14159 // <4>
     */
    @ConfigDoc(defaultValue = "5000") // <5>
    String baz = PREFIX + "baz";

    /**
     * Lorem ipsum dolor sit amet, consectetur adipisicing elit. Ipsam, similique?
     *
     * @since 3.14159
     */
    @ConfigDoc(defaultValue = "999", isStartupParam = true, isRuntimeOverridable = true) // <6>
    String features = PREFIX + "features";

    /**
     * Lorem ipsum dolor sit amet, consectetur adipisicing elit. Ipsam, similique?
     *
     * @since 3.14159
     */
    @ConfigDoc(defaultValue = "1234", title = "Title Test") // <7>
    String titleTest = PREFIX + "title";

    /**
     * Lorem ipsum dolor sit amet, consectetur adipisicing elit. Ipsam, similique?
     *
     * @since 3.14159
     */
    @ConfigDoc(defaultValue = "1234", title = "Title Test", titleHeadingLevel = 1) // <8>
    String titleHeadingLevelTest = PREFIX + "titleHeadingLevelTest";
}
----
<1> A gener√°l√°st egy oszt√°lyon a `@ConfigDoc` annot√°ci√≥val aktiv√°ljuk
<2> Az `exclude` mez≈ëvel ki lehet hagyni a gener√°l√°sb√≥l mez≈ëket
<3> Alap√©rtelmezetten a javadoc le√≠r√°s ker√ºl a gener√°lt f√°jlba, amit fel√ºl lehet √≠rni az annot√°ci√≥ `description` mez≈ëj√©vel
<4> A gener√°lt t√°bl√°zat `since` oszlopa kinyerhet≈ë a `@since` javadoc tag-b≈ël
<5> A konfighoz tartoz√≥ default √©rt√©k is megadhat√≥
<6> Az `isStartupParam`-al jel√∂lhet≈ë, hogy ind√≠t√°s idej≈± a param√©ter.
Az `isRuntimeOverridable`-el jel√∂lhet≈ë, hogy fut√°s id≈ëben manipul√°lhat√≥ a param√©ter.
A k√©t param√©ter a `Features` oszlop alatt fog megjelenni emotikonokkal reprezent√°lva:
** `isStartupParam` true eset√©n az emotikon: üöÄ
** `isRuntimeOverridable` true eset√©n az emotikon: ‚è≥
<7> A `title` param√©terrel fel√ºl√≠rhatjuk az alap√©rtelmezett gener√°lt t√°bl√°zat c√≠m√©t(opcion√°lis)
<8> A `titleHeadingLevel` param√©terrel √°ll√≠thatjuk a gener√°lt t√°bl√°zat c√≠msor√°nak a szintj√©t(opcion√°lis).
Note: Ha t√∂bb param√©teren is megadjuk ugyanannak a c√≠msrnak a legkisebb √©rt√©ket fogjuk haszn√°lni a megadottak k√∂z√ºl illetve a [0,5] intervallumon k√≠v√ºli √©rt√©kekn√©l visszat√©r√ºnk az alap√©rtelmezett 3-as √©rt√©kre.

.A fenti p√©lda k√≥d eredm√©nye
image::coffee-module-docgen-config-example1.png[]

=== Dinamikus konfigur√°ci√≥s kulcsok eset√©n
A dinamikus kulccsal rendelkez≈ë konfigok eset√©n (pl. redis, mongo db),
a kulcsokat MessageFormat-nak megfelel≈ë form√°tumban kell felvenni,
majd a kulcsokat tartalmaz√≥ oszt√°lyt kell felannot√°lni a `@DynamicConfigTemplate` annot√°ci√≥val,
valamint az oszt√°lyt vagy v√°ltoz√≥it a m√°r ismert `@ConfigDoc` annot√°ci√≥val.

A `@DynamicConfigTemplate`-el felannot√°lt oszt√°lyokb√≥l, a `@ConfigDoc` annot√°ci√≥nak megfelel≈ë template adoc fog k√©sz√ºlni,
a `META-INF/config-templates` mapp√°ba, `fully-qualified-class-name.adoc` n√©ven.

Ezek ut√°n a config-hoz tartoz√≥ qualifier-t √©s-vagy injection pontot kell felannot√°lni a `@DynamicConfigDocs`
annot√°ci√≥val, amiben templateClass-nak a kulcsokat tartalmaz√≥ oszt√°lyt kell megadni.

A `@DynamicConfigDocs` annot√°ci√≥ feldolgoz√°sakor mind az injection pont-on, mind a qualifier-en
defini√°lt √©rt√©kek felolvas√°sra ker√ºlnek, az injection pont-ot el≈ënybe r√©szes√≠tve.

Ha ezzel megvagyunk alap√©rtelmezetten a ford√≠t√°skor az elk√©sz√ºlt `.jar` f√°jlba beker√ºl a gener√°lt asciidoc a `META-INF/dynamic_config_keys.adoc` n√©ven.

==== P√©lda

.Template oszt√°ly
[source,java]
----
@ConfigDoc
@DynamicConfigTemplate //<1>
public interface DynamicConfigTemplateExample {

    /**
     * test prefix
     */
    @ConfigDoc(exclude = true) //<2>
    String PREFIX = "test.";

    /**
     * Lorem ipsum dolor sit amet, consectetur adipisicing elit. Illo, placeat!
     */
    String foo = PREFIX + "{0}.foo"; //<3>
}
----
<1> A template gener√°l√°st egy oszt√°lyon a `@ConfigDoc` √©s `@DynamicConfigTemplate` annot√°ci√≥val aktiv√°ljuk
<2> A mez≈ëk≈ën hazsn√°lhat√≥ a `@ConfigDoc` a template elk√©sz√≠t√©s√©hez
<3> A kulcs v√°ltoz√≥ r√©sze MessageFormat-nak megfelel≈ë placeholderekkel

.Qualifier
[source,java]
----
@DynamicConfigDocs( // <1>
        template = DynamicConfigTemplateExample.class, // <2>
        title = "Dynamic config {0} config keys", // <3>
        description = "Dyn configuration keys" // <4>
)
public @interface DynamicConfigurationQualifierExample {

    /**
     * Config key of the desired dynamic configuration
     *
     * @return config key
     */
    String configKey();

}
----
<1> Alap√©rtelmezett √©rt√©keket tartalmaz√≥ @DynamicConfigDocs annot√°ci√≥ a qualifieren
<2> A dinamikus konfighoz haszn√°lni k√≠v√°nt template
<3> Alap√©rtelmezett c√≠m a konfignak (placeholder-eket tartalmazhat)
<4> Alap√©rtelmezett le√≠r√°s a konfigr√≥l (placeholder-eket tartalmazhat)

.Injection point
[source,java]
----
public class DynamicConfigInjectionPointExample {

    @Inject
    @DynamicConfigDocs(templateVariables = "abc") //<1>
    @DynamicConfigurationQualifierExample(configKey = "abc")
    private Object injectedConfig;

    @Inject
    @DynamicConfigDocs(templateVariables = "xyz", title = "Title override for config key {0}") //<2>
    @DynamicConfigurationQualifierExample(configKey = "xyz")
    private Object otherConfig;
}

----
<1> A qualifieren tal√°lhat√≥ template-be behelyettes√≠teni k√≠v√°nt konfig kulcs: `abc`
<2> M√°sodik elt√©r≈ë kulcs√∫ konfig: `xyz`, fel√ºl√≠rt c√≠mmel

.A fenti p√©lda k√≥d eredm√©nye
image::coffee-module-docgen-config-dynamic-example1.png[]

== Konfigur√°ci√≥

Mivel a gener√°l√°s annotation processor-t haszn√°l, ez√©rt konfigur√°lni a ford√≠t√°s sor√°n a `-A` kapcsol√≥val lehet.
Ezt maven eset√©n a `maven-compiler-plugin`-on kereszt√ºl lehet megadni:

.pom.xml p√©lda
[source,xml]
----
<build>
    <plugins>
        <plugin>
            <artifactId>maven-compiler-plugin</artifactId>
            <configuration>
                <compilerArgs>
                    <arg>-Acoffee.docgen.config.outputDir=${project.basedir}/../docs/</arg> #<1>
                    <arg>-Acoffee.docgen.config.outputFileName=${project.name}_config.adoc</arg> #<2>
                    <arg>-Acoffee.docgen.config.outputToClassPath=false</arg> #<3>
                    <arg>-Acoffee.docgen.config.dynamicOutputFileName=dynamic_${project.name}_config.adoc</arg> #<4>
                    <arg>-Acoffee.docgen.config.columns=key,since,description</arg> #<5>
                </compilerArgs>
            </configuration>
        </plugin>
    </plugins>
</build>
----

<1> A mappa ahova a gener√°lt f√°jlt rakjuk. Default: `META-INF/`
<2> A gener√°lt f√°jl neve. Default: `config_keys.adoc`
<3> A gener√°lt f√°jlt a classpath-ra kell-e rakni, azaz szeretn√©nk-e, hogy az elk√©sz√ºlt jar f√°jlba beker√ºlj√∂n. Default: `true`
<4> A gener√°lt f√°jl neve dinamikus konfigur√°ci√≥kra. Default: `dynamic_config_keys.adoc`
<5> A gener√°lt t√°bl√°zatban megjelen√≠tett oszlopok a megadott sorrendben. Default: `key, source, description, default_value, since` (√∂sszes oszlop)
